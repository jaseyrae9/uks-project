{% extends 'base.html' %}

{% block content %}

<h3 style="margin-bottom: 20px">{{object.title}}
    <span style="float: right;">
        <a href="{% url 'one_project' object.project.id %}" class="btn btn-secondary"><i style="margin-right: 10px" class="fas fa-arrow-circle-left"></i>Return to project</a>
    </span>
</h3>

<h6 style="margin-bottom: 50px">{{object.description}}
    <span style="float: right;">
        <a href="{% url 'edit_issue' object.project.id object.id %}" class="btn btn-info"><i style="margin-right: 10px" class="fas fa-edit"></i>Edit</a>
        {% if object.state == "OP" %}
            <a href="{% url 'change_state_issue' object.project.id object.id %}" class="btn btn-secondary"><i style="margin-right: 10px" class="fas fa-times-circle"></i>Close</a>
        {% else %}
            <a href="{% url 'change_state_issue' object.project.id object.id %}" class="btn btn-info"><i style="margin-right: 10px" class="fas fa-exclamation-circle"></i>Reopen</a>
        {% endif %}
        <a href="{% url 'delete_issue' object.project.id object.id %}" class="btn btn-secondary"><i style="margin-right: 10px" class="fas fa-trash-alt"></i>Delete</a>
    </span>
</h6>

<h6>
    {% if issue.state == 'CL'%}
        <i style="margin-right: 10px; margin-top: 8px; color: red" class="fas fa-exclamation-circle"></i>This issue is closed.
    {% else %}
    {% endif %}
</h6>

<hr>

<div style="margin-top: 20px">
    <span><a href="{% url 'new_comment' object.id %}" class="btn btn-info"><i style="margin-right: 10px" class="fas fa-plus-circle"></i>New comment</a></span>
    <div style="margin-top: 20px">
        {% if object.comment_set.all %}
            <!-- list of comments -->
            {% for comment in object.comment_set.all|dictsort:"comment.time" %}
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex bd-highlight border-bottom mb-2">
                            <div class="p-2 bd-highlight">
                                <i style="margin-right: 10px; margin-top: 8px; color: #17a2b8" class="fas fa-user-circle"></i> 
                                    <span style="font-size: 1.25rem; color: #17a2b8" class="card-title"> {{comment.user.name}} </span>
                                    <span class="text-muted"> commented on {{comment.time}} </span>
                            </div>
                            <div class="ml-auto p-2 bd-highlight text-muted"> 
                                <a data-toggle="tooltip" data-placement="top" title="Edit issue" href="{% url 'edit_comment' comment.issue_id comment.id %}"><i class="fa fa-edit" style="color: #17a2b8"></i></a>
                                <a data-toggle="tooltip" data-placement="top" title="Delete issue" href="{% url 'delete_comment' comment.issue_id comment.id %}"><i class="fa fa-trash" style="color:gray"></i></a>

                            </div>
                        </div>
                        <div class="row">
                            <i style="margin-right: 10px; margin-top: 8px; color: white" class="fas fa-ellipsis-h"></i>
                            <p class="card-text">{{comment.description}}</p>
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <p>There are no comments for this issue.</p>
        {% endif %}
    </div>
</div>
{% endblock %}